<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/utils/lib/timers.js - Itsa</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="Itsa"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.0.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/Array.html">Array</a></li>
            
                <li><a href="../classes/document.html">document</a></li>
            
                <li><a href="../classes/Element.html">Element</a></li>
            
                <li><a href="../classes/Event.html">Event</a></li>
            
                <li><a href="../classes/Event.Emitter.html">Event.Emitter</a></li>
            
                <li><a href="../classes/Event.Listener.html">Event.Listener</a></li>
            
                <li><a href="../classes/Function.html">Function</a></li>
            
                <li><a href="../classes/IO.html">IO</a></li>
            
                <li><a href="../classes/ITSA.html">ITSA</a></li>
            
                <li><a href="../classes/NodeList.html">NodeList</a></li>
            
                <li><a href="../classes/Object.html">Object</a></li>
            
                <li><a href="../classes/Promise.html">Promise</a></li>
            
                <li><a href="../classes/String.html">String</a></li>
            
                <li><a href="../classes/Utils.html">Utils</a></li>
            
                <li><a href="../classes/window.html">window</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/dom-ext.html">dom-ext</a></li>
            
                <li><a href="../modules/event.html">event</a></li>
            
                <li><a href="../modules/event-dom.html">event-dom</a></li>
            
                <li><a href="../modules/event-dragdrop.html">event-dragdrop</a></li>
            
                <li><a href="../modules/event-emitter.html">event-emitter</a></li>
            
                <li><a href="../modules/event-hover.html">event-hover</a></li>
            
                <li><a href="../modules/event-listener.html">event-listener</a></li>
            
                <li><a href="../modules/event-mobile.html">event-mobile</a></li>
            
                <li><a href="../modules/io.html">io</a></li>
            
                <li><a href="../modules/io-assets.html">io-assets</a></li>
            
                <li><a href="../modules/io-cors.html">io-cors</a></li>
            
                <li><a href="../modules/io-jsonp.html">io-jsonp</a></li>
            
                <li><a href="../modules/io-transfer.html">io-transfer</a></li>
            
                <li><a href="../modules/io-xml.html">io-xml</a></li>
            
                <li><a href="../modules/itsa.build.html">itsa.build</a></li>
            
                <li><a href="../modules/js-ext.html">js-ext</a></li>
            
                <li><a href="../modules/lib_array.js.html">lib/array.js</a></li>
            
                <li><a href="../modules/lib_document.js.html">lib/document.js</a></li>
            
                <li><a href="../modules/lib_element.js.html">lib/element.js</a></li>
            
                <li><a href="../modules/lib_function.js.html">lib/function.js</a></li>
            
                <li><a href="../modules/lib_nodelist.js.html">lib/nodelist.js</a></li>
            
                <li><a href="../modules/lib_object.js.html">lib/object.js</a></li>
            
                <li><a href="../modules/lib_promise.s.html">lib/promise.s</a></li>
            
                <li><a href="../modules/lib_string.js.html">lib/string.js</a></li>
            
                <li><a href="../modules/node-win.html">node-win</a></li>
            
                <li><a href="../modules/utils.html">utils</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src/utils/lib/timers.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * Collection of various utility functions.
 *
 *
 * &lt;i&gt;Copyright (c) 2014 ITSA - https://github.com/itsa&lt;/i&gt;
 * New BSD License - http://choosealicense.com/licenses/bsd-3-clause/
 *
 * @module utils
 * @class Utils
 * @static
*/


(function (global) {

    &quot;use strict&quot;;

    require(&#x27;polyfill/polyfill-base.js&#x27;);

    var NAME = &#x27;[utils-timers]: &#x27;,
        _asynchronizer, _async;

    /**
     * Forces a function to be run asynchronously, but as fast as possible. In Node.js
     * this is achieved using &#x60;setImmediate&#x60; or &#x60;process.nextTick&#x60;.
     *
     * @method _asynchronizer
     * @param callbackFn {Function} The function to call asynchronously
     * @static
     * @private
    **/
    _asynchronizer = (typeof setImmediate !== &#x27;undefined&#x27;) ? function (fn) {setImmediate(fn);} :
                        ((typeof process !== &#x27;undefined&#x27;) &amp;&amp; process.nextTick) ? process.nextTick : function (fn) {setTimeout(fn, 0);};

    /**
     * Invokes the callbackFn once in the next turn of the JavaScript event loop. If the function
     * requires a specific execution context or arguments, wrap it with Function.bind.
     *
     * I.async returns an object with a cancel method.  If the cancel method is
     * called before the callback function, the callback function won&#x27;t be called.
     *
     * @method async
     * @param {Function} callbackFn
     * @param [invokeAfterFn=true] {boolean} set to false to prevent the _afterSyncFn to be invoked
     * @return {Object} An object with a cancel method.  If the cancel method is
     * called before the callback function, the callback function won&#x27;t be called.
    **/
    _async = function (callbackFn, invokeAfterFn) {
        console.log(NAME, &#x27;async&#x27;);
        var host = this || global,
            canceled;

        invokeAfterFn = (typeof invokeAfterFn === &#x27;boolean&#x27;) ? invokeAfterFn : true;
        (typeof callbackFn===&#x27;function&#x27;) &amp;&amp; _asynchronizer(function () {
            if (!canceled) {
                console.log(NAME, &#x27;async is running its callbakcFn&#x27;);
                callbackFn();
                // in case host._afterAsyncFn is defined: invoke it, to identify that later has been executed
                invokeAfterFn &amp;&amp; host._afterAsyncFn &amp;&amp; host._afterAsyncFn();
            }
        });

        return {
            cancel: function () {
                canceled = true;
            }
        };
    };

    /**
     * Invokes the callbackFn once in the next turn of the JavaScript event loop. If the function
     * requires a specific execution context or arguments, wrap it with Function.bind.
     *
     * I.async returns an object with a cancel method.  If the cancel method is
     * called before the callback function, the callback function won&#x27;t be called.
     *
     * @method async
     * @param {Function} callbackFn
     * @param [invokeAfterFn=true] {boolean} set to false to prevent the _afterSyncFn to be invoked
     * @return {Object} An object with a cancel method.  If the cancel method is
     * called before the callback function, the callback function won&#x27;t be called.
    **/
    module.exports.async = _async;

    /**
     * Invokes the callbackFn after a timeout (asynchronous). If the function
     * requires a specific execution context or arguments, wrap it with Function.bind.
     *
     * To invoke the callback function periodic, set &#x27;periodic&#x27; either &#x27;true&#x27;, or specify a second timeout.
     * If number, then periodic is considered &#x27;true&#x27; but with a perdiod defined by &#x27;periodic&#x27;,
     * which means: the first timer executes after &#x27;timeout&#x27; and next timers after &#x27;period&#x27;.
     *
     * I.later returns an object with a cancel method.  If the cancel() method is
     * called before the callback function, the callback function won&#x27;t be called.
     *
     * @method later
     * @param callbackFn {Function} the function to execute.
     * @param [timeout] {Number} the number of milliseconds to wait until the callbackFn is executed.
     * when not set, the callback function is invoked once in the next turn of the JavaScript event loop.
     * @param [periodic] {boolean|Number} if true, executes continuously at supplied, if number, then periodic is considered &#x27;true&#x27; but with a perdiod
     * defined by &#x27;periodic&#x27;, which means: the first timer executes after &#x27;timeout&#x27; and next timers after &#x27;period&#x27;.
     * The interval executes until canceled.
     * @param [invokeAfterFn=true] {boolean} set to false to prevent the _afterSyncFn to be invoked
     * @return {object} a timer object. Call the cancel() method on this object to stop the timer.
    */
    module.exports.later = function (callbackFn, timeout, periodic, invokeAfterFn) {
        console.log(NAME, &#x27;later --&gt; timeout: &#x27;+timeout+&#x27;ms | periodic: &#x27;+periodic);
        var host = this || global,
            canceled = false;
        invokeAfterFn = (typeof invokeAfterFn === &#x27;boolean&#x27;) ? invokeAfterFn : true;
        if (!timeout) {
            return _async(callbackFn);
        }
        var interval = periodic,
            secondtimeout = (typeof interval===&#x27;number&#x27;),
            secondairId,
            wrapper = function() {
                // IE 8- and also nodejs may execute a callback, so in order to preserve
                // the cancel() === no more runny-run, we have to build in an extra conditional
                if (!canceled) {
                    console.log(NAME, &#x27;later is running its callbakcFn&#x27;);
                    callbackFn();
                    secondtimeout &amp;&amp; (secondairId=setInterval(wrapperInterval, interval));
                    // in case host._afterAsyncFn is defined: invoke it, to identify that later has been executed
                    invokeAfterFn &amp;&amp; host._afterAsyncFn &amp;&amp; host._afterAsyncFn();
                    // break closure inside returned object:
                    id = null;
                }
            },
            wrapperInterval = function() {
                // IE 8- and also nodejs may execute a setInterval callback one last time
                // after clearInterval was called, so in order to preserve
                // the cancel() === no more runny-run, we have to build in an extra conditional
                if (!canceled) {
                    console.log(NAME, &#x27;later is running its callbakcFn&#x27;);
                    callbackFn();
                    // in case host._afterAsyncFn is defined: invoke it, to identify that later has been executed
                    invokeAfterFn &amp;&amp; host._afterAsyncFn &amp;&amp; host._afterAsyncFn();
                }
            },
            id;
        (typeof callbackFn===&#x27;function&#x27;) &amp;&amp; (id=(interval &amp;&amp; !secondtimeout) ? setInterval(wrapperInterval, timeout) : setTimeout(wrapper, timeout));

        return {
            cancel: function() {
                canceled = true;
                (interval &amp;&amp; !secondtimeout) ? clearInterval(id) : clearTimeout(id);
                secondairId &amp;&amp; clearInterval(secondairId);
                // break closure:
                id = null;
                secondairId = null;
            }
        };
    };

}(typeof global !== &#x27;undefined&#x27; ? global : /* istanbul ignore next */ this));

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
